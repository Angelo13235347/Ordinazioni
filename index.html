<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Comande - Pizzeria</title>
    <style>
        /* Splash Screen Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeIn 0.5s ease-out;
        }
        
        #splash-logo {
            width: 200px;
            height: 200px;
            object-fit: contain;
            animation: pulse 2s infinite ease-in-out;
        }
        
        #splash-text {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            animation: slideUp 0.8s ease-out 0.3s both;
        }
        
        #splash-loading {
            margin-top: 30px;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #e74c3c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Stili generali */
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --info: #3498db;
        }
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            padding: 10px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
        }
        h1 {
            margin: 0;
            font-size: 22px;
        }
        h2 {
            color: var(--primary);
            margin-top: 0;
            font-size: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 8px;
        }
        h3 {
            color: var(--primary);
            margin-top: 15px;
            font-size: 18px;
        }
        .screen {
            padding: 15px;
            display: none;
        }
        .screen.active {
            display: block;
        }
        .form-group {
            margin-bottom: 12px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
            margin-top: 8px;
            transition: background 0.3s;
        }
        .btn:hover {
            background-color: #c0392b;
        }
        .btn-secondary {
            background-color: var(--primary);
        }
        .btn-secondary:hover {
            background-color: #1a252f;
        }
        .btn-info {
            background-color: var(--info);
        }
        .btn-info:hover {
            background-color: #2980b9;
        }
        .btn-success {
            background-color: var(--success);
        }
        .btn-success:hover {
            background-color: #219653;
        }
        .menu-card {
            background: var(--light);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border-left: 4px solid var(--secondary);
        }
        .menu-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }
        .menu-price {
            float: right;
            font-weight: bold;
            color: var(--secondary);
            font-size: 15px;
        }
        .menu-description {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .quantity-label {
            flex-grow: 1;
            font-size: 14px;
        }
        .quantity-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quantity-value {
            margin: 0 12px;
            font-size: 16px;
            min-width: 18px;
            text-align: center;
        }
        .order-summary {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .summary-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ddd;
            font-size: 14px;
        }
        .total {
            font-size: 16px;
            font-weight: bold;
            color: var(--secondary);
            margin-top: 12px;
            text-align: right;
        }
        .notes-section {
            margin-top: 15px;
        }
        .pizza-notes, .dessert-notes {
            margin-top: 12px;
        }
        .error {
            color: var(--secondary);
            font-size: 13px;
            margin-top: 5px;
        }
        .orders-list {
            margin-top: 15px;
        }
        .order-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .order-title {
            font-weight: 600;
            color: var(--primary);
            font-size: 15px;
        }
        .order-meta {
            font-size: 13px;
            color: #666;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .max-reached {
            color: var(--secondary);
            font-weight: bold;
            margin-left: 8px;
            font-size: 13px;
        }
        .summary-btn {
            background-color: var(--success);
            margin-bottom: 15px;
        }
        .summary-btn:hover {
            background-color: #219653;
        }
        .free-item {
            color: var(--success);
            font-weight: bold;
        }
        .modal-tabs {
            display: flex;
            margin-bottom: 12px;
            border-bottom: 1px solid #ddd;
        }
        .modal-tab {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 14px;
        }
        .modal-tab.active {
            border-bottom: 2px solid var(--secondary);
            font-weight: bold;
        }
        .modal-content {
            display: none;
        }
        .modal-content.active {
            display: block;
        }
        .water-types {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        .water-type {
            flex: 1;
            min-width: 120px;
        }
        
        /* Nuovi stili */
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
        }
        
        .main-btn {
            padding: 20px;
            font-size: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .new-order-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .view-orders-btn {
            background-color: #2c3e50;
            color: white;
        }
        
        .main-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .edit-btn {
            background-color: #3498db;
        }
        
        .edit-btn:hover {
            background-color: #2980b9;
        }
        
        .order-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .order-section {
            margin-bottom: 20px;
        }
        
        #operator-display {
            font-size: 14px;
            margin-top: 5px;
            font-weight: bold;
        }

        /* Stili per gli alert personalizzati */
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 99999;
            max-width: 90%;
            width: 350px;
            text-align: center;
            display: none;
        }
        
        .custom-alert h3 {
            margin-top: 0;
            color: var(--primary);
            font-size: 18px;
        }
        
        .custom-alert p {
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .custom-alert-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .custom-alert-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        
        .custom-alert-confirm {
            background-color: var(--secondary);
            color: white;
        }
        
        .custom-alert-cancel {
            background-color: #ddd;
            color: #333;
        }
        
        .custom-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 99998;
            display: none;
        }

        /* Stili per la stampa (nascosto) */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                font-size: 14px;
                padding: 10px;
            }
            .no-print {
                display: none !important;
            }
            .print-header {
                text-align: center;
                margin-bottom: 15px;
                border-bottom: 2px solid #000;
                padding-bottom: 5px;
            }
            .print-title {
                font-size: 20px;
                margin-bottom: 5px;
            }
            .print-subtitle {
                font-size: 16px;
                color: #555;
            }
            .print-order-item {
                margin-bottom: 8px;
                padding-bottom: 8px;
                border-bottom: 1px dashed #ddd;
            }
            .print-total {
                font-size: 18px;
                font-weight: bold;
                text-align: right;
                margin-top: 15px;
            }
            .print-notes {
                margin-top: 15px;
                font-style: italic;
                font-size: 13px;
            }
            .print-footer {
                margin-top: 20px;
                text-align: center;
                font-size: 12px;
                color: #777;
            }
        }

        /* Stili per dispositivi mobili */
        @media (max-width: 600px) {
            .container {
                border-radius: 0;
            }
            
            header {
                padding: 12px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .main-btn {
                padding: 15px;
                font-size: 18px;
            }
            
            .water-types {
                flex-direction: column;
                gap: 8px;
            }
            
            .water-type {
                width: 100%;
            }
            
            .order-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .modal-tabs {
                font-size: 12px;
            }
            
            .modal-tab {
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen">
       <img id="splash-logo" src="logo.jpg" alt="Logo Pizzeria">
        <div id="splash-text">Gestione Comande Pizzeria</div>
        <div id="splash-loading"></div>
    </div>

    <!-- Custom Alert Dialog -->
    <div id="customAlertOverlay" class="custom-alert-overlay"></div>
    <div id="customAlert" class="custom-alert">
        <h3 id="customAlertTitle">Conferma</h3>
        <p id="customAlertMessage">Sei sicuro di voler procedere?</p>
        <div class="custom-alert-buttons">
            <button id="customAlertCancel" class="custom-alert-btn custom-alert-cancel">Annulla</button>
            <button id="customAlertConfirm" class="custom-alert-btn custom-alert-confirm">Conferma</button>
        </div>
    </div>

    <!-- Applicazione -->
    <div class="container" style="display: none;">
        <header>
            <h1>Gestione Comande Pizzeria</h1>
            <div id="operator-display"></div>
        </header>

        <!-- Schermata principale -->
        <div id="main-screen" class="screen active">
            <div class="main-menu">
                <div class="main-btn new-order-btn" onclick="startNewOrder()">
                    NUOVA COMANDA
                </div>
                <div class="main-btn view-orders-btn" onclick="showOrdersScreen()">
                    VISUALIZZA COMANDE
                </div>
            </div>
        </div>

        <!-- Schermata operatore (solo per primo accesso) -->
        <div id="operator-screen" class="screen">
            <div class="form-group">
                <label for="operator-name">Nome Operatore</label>
                <input type="text" id="operator-name" placeholder="Inserisci il tuo nome">
            </div>
            <button class="btn" onclick="setOperator()">Conferma</button>
        </div>

        <!-- Schermata nuova comanda -->
        <div id="new-order-screen" class="screen">
            <button class="btn summary-btn" onclick="showSummaryModal('current')">Mostra Riepilogo</button>
            
            <div class="form-group">
                <label for="table-number">Numero Tavolo</label>
                <input type="text" id="table-number" placeholder="Es: 1, 2A, 3B">
            </div>
            <div class="form-group">
                <label for="people-count">Numero Persone</label>
                <input type="number" id="people-count" min="1" value="1" onchange="updateMaxOrders()">
            </div>

            <h2>Bevande</h2>
            
            <div class="menu-card">
                <div class="menu-title">Acqua</div>
                <div class="menu-description">Naturale/Frizzante (inclusa nel menu - gratuita)</div>
                
                <div class="water-types">
                    <div class="water-type">
                        <div class="quantity-control">
                            <span class="quantity-label">Naturale</span>
                            <button class="quantity-btn" onclick="changeQuantity('acqua-naturale', -1)">-</button>
                            <span id="acqua-naturale" class="quantity-value">0</span>
                            <button class="quantity-btn" onclick="changeQuantity('acqua-naturale', 1)">+</button>
                        </div>
                    </div>
                    <div class="water-type">
                        <div class="quantity-control">
                            <span class="quantity-label">Frizzante</span>
                            <button class="quantity-btn" onclick="changeQuantity('acqua-frizzante', -1)">-</button>
                            <span id="acqua-frizzante" class="quantity-value">0</span>
                            <button class="quantity-btn" onclick="changeQuantity('acqua-frizzante', 1)">+</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="menu-card">
                <div class="menu-title">Birra alla Spina</div>
                <div class="quantity-control">
                    <span class="quantity-label">Mezzo Litro (€3)</span>
                    <button class="quantity-btn" onclick="changeQuantity('birra-mezzo', -1)">-</button>
                    <span id="birra-mezzo" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('birra-mezzo', 1)">+</button>
                </div>
                <div class="quantity-control" style="margin-top: 8px;">
                    <span class="quantity-label">Un Litro (€6)</span>
                    <button class="quantity-btn" onclick="changeQuantity('birra-litro', -1)">-</button>
                    <span id="birra-litro" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('birra-litro', 1)">+</button>
                </div>
            </div>
            
            <div class="menu-card">
                <div class="menu-title">Coca Cola</div>
                <div class="quantity-control">
                    <span class="quantity-label">Lattina (€2.5)</span>
                    <button class="quantity-btn" onclick="changeQuantity('coca-lattina', -1)">-</button>
                    <span id="coca-lattina" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('coca-lattina', 1)">+</button>
                </div>
                <div class="quantity-control" style="margin-top: 8px;">
                    <span class="quantity-label">Mezzo Litro Spina (€3)</span>
                    <button class="quantity-btn" onclick="changeQuantity('coca-mezzo', -1)">-</button>
                    <span id="coca-mezzo" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('coca-mezzo', 1)">+</button>
                </div>
                <div class="quantity-control" style="margin-top: 8px;">
                    <span class="quantity-label">Un Litro Spina (€6)</span>
                    <button class="quantity-btn" onclick="changeQuantity('coca-litro', -1)">-</button>
                    <span id="coca-litro" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('coca-litro', 1)">+</button>
                </div>
            </div>
            
            <div class="menu-card">
                <div class="menu-title">Vino alla Spina</div>
                <div class="quantity-control">
                    <span class="quantity-label">Mezzo Litro (€4)</span>
                    <button class="quantity-btn" onclick="changeQuantity('vino-mezzo', -1)">-</button>
                    <span id="vino-mezzo" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('vino-mezzo', 1)">+</button>
                </div>
                <div class="quantity-control" style="margin-top: 8px;">
                    <span class="quantity-label">Un Litro (€8)</span>
                    <button class="quantity-btn" onclick="changeQuantity('vino-litro', -1)">-</button>
                    <span id="vino-litro" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('vino-litro', 1)">+</button>
                </div>
            </div>

            <h2>Seleziona Menu</h2>
            
            <!-- Menu Completo -->
            <div class="menu-card">
                <div class="menu-title">Menu Completo <span class="menu-price">€20</span></div>
                <div class="menu-description">Antipasto, Pizza a scelta, Dolce</div>
                <div class="quantity-control">
                    <span class="quantity-label">Quantità</span>
                    <button class="quantity-btn" onclick="changeQuantity('menu-completo', -1)">-</button>
                    <span id="menu-completo" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('menu-completo', 1)">+</button>
                    <span id="max-completo" class="max-reached"></span>
                </div>
            </div>
            
            <!-- Menu Solo Pizza -->
            <div class="menu-card">
                <div class="menu-title">Menu Solo Pizza <span class="menu-price">€15</span></div>
                <div class="menu-description">Pizza a scelta, Dolce</div>
                <div class="quantity-control">
                    <span class="quantity-label">Quantità</span>
                    <button class="quantity-btn" onclick="changeQuantity('menu-pizza', -1)">-</button>
                    <span id="menu-pizza" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('menu-pizza', 1)">+</button>
                    <span id="max-pizza" class="max-reached"></span>
                </div>
            </div>
            
            <!-- Menu Bambino -->
            <div class="menu-card">
                <div class="menu-title">Menu Bambino <span class="menu-price">€12</span></div>
                <div class="menu-description">Pizza a scelta, Bibita</div>
                <div class="quantity-control">
                    <span class="quantity-label">Quantità</span>
                    <button class="quantity-btn" onclick="changeQuantity('menu-bambino', -1)">-</button>
                    <span id="menu-bambino" class="quantity-value">0</span>
                    <button class="quantity-btn" onclick="changeQuantity('menu-bambino', 1)">+</button>
                    <span id="max-bambino" class="max-reached"></span>
                </div>
            </div>

            <!-- Note per le pizze -->
            <div class="notes-section">
                <h2>Gusti Pizza</h2>
                <p>Inserisci i gusti di pizza richiesti dai clienti (uno per riga)</p>
                <textarea id="pizza-notes" rows="4" placeholder="Es: 1 Margherita, 2 Diavola, 1 Quattro Formaggi..."></textarea>
            </div>

            <!-- Note per i dolci -->
            <div class="notes-section">
                <h2>Gusti Dolci</h2>
                <p>Inserisci i dolci richiesti dai clienti (uno per riga)</p>
                <textarea id="dessert-notes" rows="3" placeholder="Es: 1 Tiramisù, 2 Panna Cotta..."></textarea>
            </div>

            <div id="menu-error" class="error"></div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="showScreen('main')">Annulla</button>
                <button class="btn" onclick="goToSummaryScreen()">Salva Ordine</button>
            </div>
        </div>

        <!-- Schermata visualizza comande -->
        <div id="orders-screen" class="screen">
            <h2>Gestione Comande</h2>
            <div class="button-group">
                <button class="btn" onclick="showScreen('main')">Torna al Menu</button>
                <button class="btn btn-info" onclick="showFullSummary()">Recap Completo</button>
            </div>
            
            <div id="orders-management-area" class="orders-list"></div>
        </div>

        <!-- Schermata modifica comanda -->
        <div id="edit-order-screen" class="screen">
            <h2>Modifica Comanda - Tavolo <span id="edit-table-display"></span></h2>
            
            <div id="edit-order-content">
                <!-- Contenuto dinamico -->
            </div>
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="cancelEdit()">Annulla</button>
                <button class="btn btn-success" onclick="saveEditedOrder()">Salva Modifiche</button>
                <button class="btn btn-info" onclick="showSummaryModal('current')">Mostra Riepilogo</button>
            </div>
        </div>
    </div>

    <!-- Modal per il riepilogo -->
    <div id="summary-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 15px; border-radius: 10px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div class="modal-tabs">
                <div id="current-tab" class="modal-tab active" onclick="switchTab('current')">Ordine Corrente</div>
                <div id="all-tab" class="modal-tab" onclick="switchTab('all')">Tutti gli Ordini</div>
            </div>
            
            <div id="current-summary" class="modal-content active">
                <h2 style="margin-top: 0;">Riepilogo Ordine</h2>
                <div id="modal-table-summary" class="order-summary"></div>
                <div id="modal-drinks-summary" class="order-summary"></div>
                <div id="modal-order-summary" class="order-summary"></div>
                <div id="modal-total-summary" class="total"></div>
                <button class="btn" onclick="printCurrentOrder()">Stampa Ordine</button>
            </div>
            
            <div id="all-summary" class="modal-content">
                <h2 style="margin-top: 0;">Riepilogo di Tutti gli Ordini</h2>
                <div id="modal-all-orders" class="order-summary"></div>
            </div>
            
            <button class="btn" onclick="hideSummaryModal()" style="margin-top: 15px;">Chiudi</button>
        </div>
    </div>

    <!-- Template per la stampa (nascosto) -->
    <div id="print-template" style="display: none;">
        <div class="print-section">
            <div class="print-header">
                <div class="print-title">Pizzeria Bella Napoli</div>
                <div class="print-subtitle">Via Roma 123, Milano - Tel. 02 1234567</div>
            </div>
            
            <div class="print-order-info">
                <div><strong>Tavolo:</strong> <span id="print-table"></span></div>
                <div><strong>Operatore:</strong> <span id="print-operator"></span></div>
                <div><strong>Ora:</strong> <span id="print-date"></span></div>
            </div>
            
            <h3 class="print-order-title">Dettaglio Ordine</h3>
            
            <div id="print-menu-items"></div>
            <div id="print-drink-items"></div>
            
            <div class="print-total">
                <strong>TOTALE: €<span id="print-total-amount"></span></strong>
            </div>
            
            <div id="print-notes-container" class="print-notes" style="display: none;">
                <h4>Note:</h4>
                <div id="print-notes"></div>
            </div>
            
            <div class="print-footer">
                Servizio al tavolo - Pagamento alla cassa
            </div>
        </div>
    </div>

    <script>
        // Variabili globali
        let currentOperator = localStorage.getItem('pizzeria-operator') || "";
        let currentOrder = {
            operator: "",
            table: "",
            people: 1,
            menus: {
                completo: 0,
                pizza: 0,
                bambino: 0
            },
            drinks: {
                acquaNaturale: 0,
                acquaFrizzante: 0,
                birraMezzo: 0,
                birraLitro: 0,
                cocaLattina: 0,
                cocaMezzo: 0,
                cocaLitro: 0,
                vinoMezzo: 0,
                vinoLitro: 0
            },
            pizzaNotes: "",
            dessertNotes: "",
            timestamp: ""
        };

        let allOrders = JSON.parse(localStorage.getItem('pizzeria-orders')) || [];
        let currentlyEditingIndex = -1;

        // Mostra splash screen all'avvio
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('splash-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash-screen').style.display = 'none';
                    document.querySelector('.container').style.display = 'block';
                    
                    // Se l'operatore è già registrato, mostra il menu principale
                    if (currentOperator) {
                        showMainScreen();
                    } else {
                        showScreen('operator');
                    }
                }, 500);
            }, 2000);
        });

        // Funzioni di navigazione
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            switch(screenName) {
                case 'main':
                    showMainScreen();
                    break;
                case 'operator':
                    document.getElementById('operator-screen').classList.add('active');
                    break;
                case 'new-order':
                    resetOrder();
                    document.getElementById('new-order-screen').classList.add('active');
                    break;
                case 'orders':
                    showOrdersScreen();
                    break;
                case 'edit-order':
                    document.getElementById('edit-order-screen').classList.add('active');
                    break;
            }
        }

        function showMainScreen() {
            document.getElementById('main-screen').classList.add('active');
            document.getElementById('operator-display').textContent = `Operatore: ${currentOperator}`;
        }

        function setOperator() {
            const operator = document.getElementById('operator-name').value.trim();
            if (!operator) {
                showCustomAlert(
                    "Attenzione", 
                    "Inserisci il nome dell'operatore",
                    function() {
                        document.getElementById('operator-name').focus();
                    }
                );
                return;
            }
            currentOperator = operator;
            localStorage.setItem('pizzeria-operator', operator);
            
            showCustomAlert(
                "Operatore Registrato", 
                `Benvenuto ${operator}!`,
                function() {
                    showMainScreen();
                }
            );
        }

        function startNewOrder() {
            currentOrder.operator = currentOperator;
            showScreen('new-order');
        }

        function showOrdersScreen() {
            document.getElementById('orders-screen').classList.add('active');
            renderOrdersManagement();
        }

        // Funzione per visualizzare gli ordini con opzioni di modifica
        function renderOrdersManagement() {
            const container = document.getElementById('orders-management-area');
            container.innerHTML = '';
            
            if (allOrders.length === 0) {
                container.innerHTML = '<p>Nessun ordine registrato</p>';
                return;
            }
            
            // Raggruppa per tavolo
            const tables = {};
            allOrders.forEach((order, index) => {
                if (!tables[order.table]) {
                    tables[order.table] = [];
                }
                tables[order.table].push({...order, originalIndex: index});
            });
            
            // Crea una sezione per ogni tavolo
            for (const [table, orders] of Object.entries(tables)) {
                const tableSection = document.createElement('div');
                tableSection.className = 'order-card';
                tableSection.innerHTML = `<h3>Tavolo ${table}</h3>`;
                
                orders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'order-summary';
                    
                    let orderInfo = `
                        <p><strong>${order.timestamp}</strong> - ${order.people} persone - Totale: €${calculateOrderTotal(order).toFixed(2)}</p>`;
                    
                    // Menu ordinati
                    if (order.menus.completo > 0 || order.menus.pizza > 0 || order.menus.bambino > 0) {
                        orderInfo += `<p><strong>Menu:</strong> `;
                        let menus = [];
                        if (order.menus.completo > 0) menus.push(`${order.menus.completo} Completo`);
                        if (order.menus.pizza > 0) menus.push(`${order.menus.pizza} Solo Pizza`);
                        if (order.menus.bambino > 0) menus.push(`${order.menus.bambino} Bambino`);
                        orderInfo += menus.join(', ') + `</p>`;
                    }
                    
                    // Pizze
                    if (order.pizzaNotes) {
                        orderInfo += `<p><strong>Pizze:</strong><br>${order.pizzaNotes.replace(/\n/g, '<br>')}</p>`;
                    }
                    
                    // Dolci
                    if (order.dessertNotes) {
                        orderInfo += `<p><strong>Dolci:</strong><br>${order.dessertNotes.replace(/\n/g, '<br>')}</p>`;
                    }
                    
                    // Bevande
                    orderInfo += `<p><strong>Bevande:</strong> `;
                    let drinks = [];
                    if (order.drinks.acquaNaturale > 0) drinks.push(`${order.drinks.acquaNaturale} Acqua Naturale`);
                    if (order.drinks.acquaFrizzante > 0) drinks.push(`${order.drinks.acquaFrizzante} Acqua Frizzante`);
                    if (order.drinks.birraMezzo > 0) drinks.push(`${order.drinks.birraMezzo} Birra 0.5L`);
                    if (order.drinks.birraLitro > 0) drinks.push(`${order.drinks.birraLitro} Birra 1L`);
                    if (order.drinks.cocaLattina > 0) drinks.push(`${order.drinks.cocaLattina} Coca Lattina`);
                    if (order.drinks.cocaMezzo > 0) drinks.push(`${order.drinks.cocaMezzo} Coca 0.5L`);
                    if (order.drinks.cocaLitro > 0) drinks.push(`${order.drinks.cocaLitro} Coca 1L`);
                    if (order.drinks.vinoMezzo > 0) drinks.push(`${order.drinks.vinoMezzo} Vino 0.5L`);
                    if (order.drinks.vinoLitro > 0) drinks.push(`${order.drinks.vinoLitro} Vino 1L`);
                    orderInfo += drinks.join(', ') + `</p>`;
                    
                    // Pulsanti azione
                    orderInfo += `
                        <div class="order-actions">
                            <button class="btn" onclick="editOrder(${order.originalIndex})">Modifica</button>
                            <button class="btn btn-secondary" onclick="deleteOrder(${order.originalIndex})">Elimina</button>
                            <button class="btn btn-info" onclick="printOrder(${order.originalIndex})">Stampa</button>
                        </div>
                    `;
                    
                    orderElement.innerHTML = orderInfo;
                    tableSection.appendChild(orderElement);
                });
                
                container.appendChild(tableSection);
            }
        }

        // Funzione per modificare un ordine esistente
        function editOrder(index) {
            currentlyEditingIndex = index;
            const order = allOrders[index];
            
            // Popola la schermata di modifica con i dati dell'ordine
            const editContent = document.getElementById('edit-order-content');
            document.getElementById('edit-table-display').textContent = order.table;
            
            editContent.innerHTML = `
                <div class="form-group">
                    <label for="edit-table-number">Numero Tavolo</label>
                    <input type="text" id="edit-table-number" value="${order.table}">
                </div>
                
                <div class="form-group">
                    <label for="edit-people-count">Numero Persone</label>
                    <input type="number" id="edit-people-count" min="1" value="${order.people}">
                </div>
                
                <div class="order-section">
                    <h3>Menu Ordinati</h3>
                    <p>Menu Completo: ${order.menus.completo}</p>
                    <p>Menu Solo Pizza: ${order.menus.pizza}</p>
                    <p>Menu Bambino: ${order.menus.bambino}</p>
                </div>
                
                <div class="notes-section">
                    <h3>Modifica Gusti Pizza</h3>
                    <textarea id="edit-pizza-notes" rows="4" placeholder="Es: 1 Margherita, 2 Diavola, 1 Quattro Formaggi...">${order.pizzaNotes || ''}</textarea>
                </div>
                
                <div class="notes-section">
                    <h3>Modifica Gusti Dolci</h3>
                    <textarea id="edit-dessert-notes" rows="3" placeholder="Es: 1 Tiramisù, 2 Panna Cotta...">${order.dessertNotes || ''}</textarea>
                </div>
                
                <div class="order-section">
                    <h3>Modifica Bevande</h3>
                    
                    <div class="menu-card">
                        <div class="menu-title">Acqua</div>
                        <div class="water-types">
                            <div class="water-type">
                                <div class="quantity-control">
                                    <span class="quantity-label">Naturale</span>
                                    <button class="quantity-btn" onclick="changeEditQuantity('edit-acqua-naturale', -1)">-</button>
                                    <span id="edit-acqua-naturale" class="quantity-value">${order.drinks.acquaNaturale}</span>
                                    <button class="quantity-btn" onclick="changeEditQuantity('edit-acqua-naturale', 1)">+</button>
                                </div>
                            </div>
                            <div class="water-type">
                                <div class="quantity-control">
                                    <span class="quantity-label">Frizzante</span>
                                    <button class="quantity-btn" onclick="changeEditQuantity('edit-acqua-frizzante', -1)">-</button>
                                    <span id="edit-acqua-frizzante" class="quantity-value">${order.drinks.acquaFrizzante}</span>
                                    <button class="quantity-btn" onclick="changeEditQuantity('edit-acqua-frizzante', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-card">
                        <div class="menu-title">Birra alla Spina</div>
                        <div class="quantity-control">
                            <span class="quantity-label">Mezzo Litro (€3)</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-birra-mezzo', -1)">-</button>
                            <span id="edit-birra-mezzo" class="quantity-value">${order.drinks.birraMezzo}</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-birra-mezzo', 1)">+</button>
                        </div>
                        <div class="quantity-control" style="margin-top: 8px;">
                            <span class="quantity-label">Un Litro (€6)</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-birra-litro', -1)">-</button>
                            <span id="edit-birra-litro" class="quantity-value">${order.drinks.birraLitro}</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-birra-litro', 1)">+</button>
                        </div>
                    </div>
                    
                    <div class="menu-card">
                        <div class="menu-title">Coca Cola</div>
                        <div class="quantity-control">
                            <span class="quantity-label">Lattina (€2.5)</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-coca-lattina', -1)">-</button>
                            <span id="edit-coca-lattina" class="quantity-value">${order.drinks.cocaLattina}</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-coca-lattina', 1)">+</button>
                        </div>
                        <div class="quantity-control" style="margin-top: 8px;">
                            <span class="quantity-label">Mezzo Litro Spina (€3)</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-coca-mezzo', -1)">-</button>
                            <span id="edit-coca-mezzo" class="quantity-value">${order.drinks.cocaMezzo}</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-coca-mezzo', 1)">+</button>
                        </div>
                    </div>
                    
                    <div class="menu-card">
                        <div class="menu-title">Vino alla Spina</div>
                        <div class="quantity-control">
                            <span class="quantity-label">Mezzo Litro (€4)</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-vino-mezzo', -1)">-</button>
                            <span id="edit-vino-mezzo" class="quantity-value">${order.drinks.vinoMezzo}</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-vino-mezzo', 1)">+</button>
                        </div>
                        <div class="quantity-control" style="margin-top: 8px;">
                            <span class="quantity-label">Un Litro (€8)</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-vino-litro', -1)">-</button>
                            <span id="edit-vino-litro" class="quantity-value">${order.drinks.vinoLitro}</span>
                            <button class="quantity-btn" onclick="changeEditQuantity('edit-vino-litro', 1)">+</button>
                        </div>
                    </div>
                </div>
            `;
            
            showScreen('edit-order');
        }

        function changeEditQuantity(item, delta) {
            const element = document.getElementById(item);
            let quantity = parseInt(element.textContent) + delta;
            if (quantity < 0) quantity = 0;
            element.textContent = quantity;
        }

        function saveEditedOrder() {
            const order = allOrders[currentlyEditingIndex];
            
            // Aggiorna i dati dell'ordine con le modifiche
            order.table = document.getElementById('edit-table-number').value;
            order.people = parseInt(document.getElementById('edit-people-count').value);
            order.pizzaNotes = document.getElementById('edit-pizza-notes').value;
            order.dessertNotes = document.getElementById('edit-dessert-notes').value;
            
            // Aggiorna le bevande
            order.drinks.acquaNaturale = parseInt(document.getElementById('edit-acqua-naturale').textContent);
            order.drinks.acquaFrizzante = parseInt(document.getElementById('edit-acqua-frizzante').textContent);
            order.drinks.birraMezzo = parseInt(document.getElementById('edit-birra-mezzo').textContent);
            order.drinks.birraLitro = parseInt(document.getElementById('edit-birra-litro').textContent);
            order.drinks.cocaLattina = parseInt(document.getElementById('edit-coca-lattina').textContent);
            order.drinks.cocaMezzo = parseInt(document.getElementById('edit-coca-mezzo').textContent);
            order.drinks.vinoMezzo = parseInt(document.getElementById('edit-vino-mezzo').textContent);
            order.drinks.vinoLitro = parseInt(document.getElementById('edit-vino-litro').textContent);
            
            // Aggiorna timestamp
            order.timestamp = new Date().toLocaleString();
            
            // Salva le modifiche
            localStorage.setItem('pizzeria-orders', JSON.stringify(allOrders));
            
            showCustomAlert(
                "Ordine Modificato", 
                "L'ordine è stato modificato con successo!",
                function() {
                    showScreen('orders');
                }
            );
        }

        function cancelEdit() {
            currentlyEditingIndex = -1;
            showScreen('orders');
        }

        // Funzioni per gestire le quantità nella nuova comanda
        function changeQuantity(item, delta) {
            const element = document.getElementById(item);
            let quantity = parseInt(element.textContent) + delta;
            
            // Controlla se stiamo modificando un menu e verifica il limite di persone
            if (item.includes('menu-')) {
                const people = parseInt(document.getElementById('people-count').value) || 1;
                const completo = parseInt(document.getElementById('menu-completo').textContent);
                const pizza = parseInt(document.getElementById('menu-pizza').textContent);
                const bambino = parseInt(document.getElementById('menu-bambino').textContent);
                const totalSelected = completo + pizza + bambino + (item === 'menu-completo' ? delta : 0) + 
                                    (item === 'menu-pizza' ? delta : 0) + (item === 'menu-bambino' ? delta : 0);
                
                if (totalSelected > people && delta > 0) {
                    showCustomAlert(
                        "Attenzione", 
                        `Non puoi superare il numero di persone (${people})`,
                        function() {
                            // Focus sul campo persone
                            document.getElementById('people-count').focus();
                        }
                    );
                    return;
                }
            }
            
            if (quantity < 0) quantity = 0;
            element.textContent = quantity;
            
            // Aggiorna i messaggi di limite per i menu
            if (item.includes('menu-')) {
                updateMaxOrders();
            }
        }

        function updateMaxOrders() {
            const people = parseInt(document.getElementById('people-count').value) || 1;
            const completo = parseInt(document.getElementById('menu-completo').textContent);
            const pizza = parseInt(document.getElementById('menu-pizza').textContent);
            const bambino = parseInt(document.getElementById('menu-bambino').textContent);
            const totalSelected = completo + pizza + bambino;
            
            // Aggiorna i messaggi di limite
            document.getElementById('max-completo').textContent = totalSelected >= people ? "Massimo raggiunto!" : "";
            document.getElementById('max-pizza').textContent = totalSelected >= people ? "Massimo raggiunto!" : "";
            document.getElementById('max-bambino').textContent = totalSelected >= people ? "Massimo raggiunto!" : "";
        }

        function goToSummaryScreen() {
            const table = document.getElementById('table-number').value.trim();
            const people = parseInt(document.getElementById('people-count').value);
            
            if (!table || !people) {
                showCustomAlert(
                    "Attenzione", 
                    "Inserisci numero tavolo e numero persone",
                    function() {
                        if (!table) {
                            document.getElementById('table-number').focus();
                        } else {
                            document.getElementById('people-count').focus();
                        }
                    }
                );
                return;
            }
            
            // Verifica che il totale dei menu non superi il numero di persone
            const completo = parseInt(document.getElementById('menu-completo').textContent);
            const pizza = parseInt(document.getElementById('menu-pizza').textContent);
            const bambino = parseInt(document.getElementById('menu-bambino').textContent);
            const totalMenu = completo + pizza + bambino;
            
            if (totalMenu > people) {
                document.getElementById('menu-error').textContent = `Attenzione! Hai selezionato ${totalMenu} menu per ${people} persone.`;
                return;
            }
            
            document.getElementById('menu-error').textContent = "";
            
            currentOrder.table = table;
            currentOrder.people = people;
            currentOrder.menus.completo = completo;
            currentOrder.menus.pizza = pizza;
            currentOrder.menus.bambino = bambino;
            currentOrder.pizzaNotes = document.getElementById('pizza-notes').value;
            currentOrder.dessertNotes = document.getElementById('dessert-notes').value;
            
            // Salva le bevande
            currentOrder.drinks.acquaNaturale = parseInt(document.getElementById('acqua-naturale').textContent);
            currentOrder.drinks.acquaFrizzante = parseInt(document.getElementById('acqua-frizzante').textContent);
            currentOrder.drinks.birraMezzo = parseInt(document.getElementById('birra-mezzo').textContent);
            currentOrder.drinks.birraLitro = parseInt(document.getElementById('birra-litro').textContent);
            currentOrder.drinks.cocaLattina = parseInt(document.getElementById('coca-lattina').textContent);
            currentOrder.drinks.cocaMezzo = parseInt(document.getElementById('coca-mezzo').textContent);
            currentOrder.drinks.cocaLitro = parseInt(document.getElementById('coca-litro').textContent);
            currentOrder.drinks.vinoMezzo = parseInt(document.getElementById('vino-mezzo').textContent);
            currentOrder.drinks.vinoLitro = parseInt(document.getElementById('vino-litro').textContent);
            
            saveOrder();
        }

        // Salva ordine
        function saveOrder() {
            currentOrder.timestamp = new Date().toLocaleString();
            allOrders.push({...currentOrder});
            localStorage.setItem('pizzeria-orders', JSON.stringify(allOrders));
            
            showCustomAlert(
                "Ordine Salvato", 
                `Ordine per il Tavolo ${currentOrder.table} salvato correttamente!`,
                function() {
                    resetOrder();
                    showScreen('orders');
                }
            );
        }

        function resetOrder() {
            currentOrder = {
                operator: currentOperator,
                table: "",
                people: 1,
                menus: {
                    completo: 0,
                    pizza: 0,
                    bambino: 0
                },
                drinks: {
                    acquaNaturale: 0,
                    acquaFrizzante: 0,
                    birraMezzo: 0,
                    birraLitro: 0,
                    cocaLattina: 0,
                    cocaMezzo: 0,
                    cocaLitro: 0,
                    vinoMezzo: 0,
                    vinoLitro: 0
                },
                pizzaNotes: "",
                dessertNotes: "",
                timestamp: ""
            };
            
            // Resetta i valori nell'interfaccia
            document.getElementById('table-number').value = "";
            document.getElementById('people-count').value = "1";
            document.getElementById('menu-completo').textContent = "0";
            document.getElementById('menu-pizza').textContent = "0";
            document.getElementById('menu-bambino').textContent = "0";
            document.getElementById('pizza-notes').value = "";
            document.getElementById('dessert-notes').value = "";
            document.getElementById('max-completo').textContent = "";
            document.getElementById('max-pizza').textContent = "";
            document.getElementById('max-bambino').textContent = "";
            
            // Resetta le bevande
            document.getElementById('acqua-naturale').textContent = "0";
            document.getElementById('acqua-frizzante').textContent = "0";
            document.getElementById('birra-mezzo').textContent = "0";
            document.getElementById('birra-litro').textContent = "0";
            document.getElementById('coca-lattina').textContent = "0";
            document.getElementById('coca-mezzo').textContent = "0";
            document.getElementById('coca-litro').textContent = "0";
            document.getElementById('vino-mezzo').textContent = "0";
            document.getElementById('vino-litro').textContent = "0";
        }

        // Funzioni per il riepilogo
        function updateSummary() {
            // Info tavolo
            let tableInfo = `<h3>Tavolo ${document.getElementById('table-number').value || '?'}`;
            const people = document.getElementById('people-count').value || 1;
            tableInfo += `</h3><p>${people} persone</p>`;
            document.getElementById('modal-table-summary').innerHTML = tableInfo;
            
            // Bevande
            let drinksHtml = "<h3>Bevande</h3>";
            
            const acquaNaturale = parseInt(document.getElementById('acqua-naturale').textContent);
            const acquaFrizzante = parseInt(document.getElementById('acqua-frizzante').textContent);
            const birraMezzo = parseInt(document.getElementById('birra-mezzo').textContent);
            const birraLitro = parseInt(document.getElementById('birra-litro').textContent);
            const cocaLattina = parseInt(document.getElementById('coca-lattina').textContent);
            const cocaMezzo = parseInt(document.getElementById('coca-mezzo').textContent);
            const cocaLitro = parseInt(document.getElementById('coca-litro').textContent);
            const vinoMezzo = parseInt(document.getElementById('vino-mezzo').textContent);
            const vinoLitro = parseInt(document.getElementById('vino-litro').textContent);
            
            if (acquaNaturale > 0 || acquaFrizzante > 0) {
                drinksHtml += `<div class="summary-item">Acqua: `;
                let acque = [];
                if (acquaNaturale > 0) acque.push(`${acquaNaturale} Naturale`);
                if (acquaFrizzante > 0) acque.push(`${acquaFrizzante} Frizzante`);
                drinksHtml += acque.join(', ') + ` <span class="free-item">(gratuita)</span></div>`;
            }
            
            drinksHtml += "<h4>Bevande Extra</h4>";
            let hasDrinks = false;
            
            if (birraMezzo > 0) {
                drinksHtml += `<div class="summary-item">Birra alla Spina (0.5L): ${birraMezzo} x €3 = <strong>€${birraMezzo * 3}</strong></div>`;
                hasDrinks = true;
            }
            if (birraLitro > 0) {
                drinksHtml += `<div class="summary-item">Birra alla Spina (1L): ${birraLitro} x €6 = <strong>€${birraLitro * 6}</strong></div>`;
                hasDrinks = true;
            }
            if (cocaLattina > 0) {
                drinksHtml += `<div class="summary-item">Coca Cola Lattina: ${cocaLattina} x €2.5 = <strong>€${cocaLattina * 2.5}</strong></div>`;
                hasDrinks = true;
            }
            if (cocaMezzo > 0) {
                drinksHtml += `<div class="summary-item">Coca Cola Spina (0.5L): ${cocaMezzo} x €3 = <strong>€${cocaMezzo * 3}</strong></div>`;
                hasDrinks = true;
            }
            if (cocaLitro > 0) {
                drinksHtml += `<div class="summary-item">Coca Cola Spina (1L): ${cocaLitro} x €6 = <strong>€${cocaLitro * 6}</strong></div>`;
                hasDrinks = true;
            }
            if (vinoMezzo > 0) {
                drinksHtml += `<div class="summary-item">Vino alla Spina (0.5L): ${vinoMezzo} x €4 = <strong>€${vinoMezzo * 4}</strong></div>`;
                hasDrinks = true;
            }
            if (vinoLitro > 0) {
                drinksHtml += `<div class="summary-item">Vino alla Spina (1L): ${vinoLitro} x €8 = <strong>€${vinoLitro * 8}</strong></div>`;
                hasDrinks = true;
            }
            
            if (!hasDrinks) {
                drinksHtml += "<p>Nessuna bevanda extra selezionata</p>";
            }
            
            document.getElementById('modal-drinks-summary').innerHTML = drinksHtml;
            
            // Menu
            let menuHtml = "<h3>Menu Ordinati</h3>";
            const completo = parseInt(document.getElementById('menu-completo').textContent);
            const pizza = parseInt(document.getElementById('menu-pizza').textContent);
            const bambino = parseInt(document.getElementById('menu-bambino').textContent);
            
            if (completo > 0) {
                menuHtml += `<div class="summary-item">Menu Completo: ${completo} x €20 = <strong>€${completo * 20}</strong></div>`;
            }
            if (pizza > 0) {
                menuHtml += `<div class="summary-item">Menu Solo Pizza: ${pizza} x €15 = <strong>€${pizza * 15}</strong></div>`;
            }
            if (bambino > 0) {
                menuHtml += `<div class="summary-item">Menu Bambino: ${bambino} x €12 = <strong>€${bambino * 12}</strong></div>`;
            }
            
            // Note pizze
            const pizzaNotes = document.getElementById('pizza-notes').value;
            if (pizzaNotes) {
                menuHtml += `<div class="summary-item"><strong>Gusti Pizza:</strong><br>${pizzaNotes.replace(/\n/g, '<br>')}</div>`;
            }
            
            // Note dolci
            const dessertNotes = document.getElementById('dessert-notes').value;
            if (dessertNotes) {
                menuHtml += `<div class="summary-item"><strong>Gusti Dolci:</strong><br>${dessertNotes.replace(/\n/g, '<br>')}</div>`;
            }
            
            document.getElementById('modal-order-summary').innerHTML = menuHtml;
            
            // Totale
            const total = calculateCurrentTotal();
            document.getElementById('modal-total-summary').innerHTML = `Totale: €${total.toFixed(2)}`;
        }

        function updateAllOrdersSummary() {
            let allOrdersHtml = "";
            
            if (allOrders.length === 0) {
                allOrdersHtml = "<p>Nessun ordine registrato</p>";
            } else {
                // Raggruppa per tavolo
                const tables = {};
                allOrders.forEach(order => {
                    if (!tables[order.table]) {
                        tables[order.table] = {
                            orders: [],
                            total: 0
                        };
                    }
                    
                    let orderTotal = calculateOrderTotal(order);
                    
                    tables[order.table].orders.push(order);
                    tables[order.table].total += orderTotal;
                });
                
                // Crea il riepilogo per ogni tavolo
                for (const [table, data] of Object.entries(tables)) {
                    allOrdersHtml += `<h3>Tavolo ${table} - Totale: €${data.total.toFixed(2)}</h3>`;
                    
                    data.orders.forEach(order => {
                        allOrdersHtml += `<div class="order-summary" style="margin-bottom: 12px;">`;
                        allOrdersHtml += `<p><strong>${order.timestamp}</strong> - ${order.people} persone - €${calculateOrderTotal(order).toFixed(2)}</p>`;
                        
                        // Dettagli ordine
                        if (order.menus.completo > 0 || order.menus.pizza > 0 || order.menus.bambino > 0) {
                            allOrdersHtml += `<p><strong>Menu:</strong> `;
                            let menus = [];
                            if (order.menus.completo > 0) menus.push(`${order.menus.completo} Completo`);
                            if (order.menus.pizza > 0) menus.push(`${order.menus.pizza} Solo Pizza`);
                            if (order.menus.bambino > 0) menus.push(`${order.menus.bambino} Bambino`);
                            allOrdersHtml += menus.join(', ') + `</p>`;
                        }
                        
                        // Pizze
                        if (order.pizzaNotes) {
                            allOrdersHtml += `<p><strong>Pizze:</strong><br>${order.pizzaNotes.replace(/\n/g, '<br>')}</p>`;
                        }
                        
                        // Dolci
                        if (order.dessertNotes) {
                            allOrdersHtml += `<p><strong>Dolci:</strong><br>${order.dessertNotes.replace(/\n/g, '<br>')}</p>`;
                        }
                        
                        // Acqua
                        if (order.drinks.acquaNaturale > 0 || order.drinks.acquaFrizzante > 0) {
                            allOrdersHtml += `<p><strong>Acqua:</strong> `;
                            let acque = [];
                            if (order.drinks.acquaNaturale > 0) acque.push(`${order.drinks.acquaNaturale} Naturale`);
                            if (order.drinks.acquaFrizzante > 0) acque.push(`${order.drinks.acquaFrizzante} Frizzante`);
                            allOrdersHtml += acque.join(', ') + ` <span class="free-item">(gratuita)</span></p>`;
                        }
                        
                        allOrdersHtml += `</div>`;
                    });
                }
            }
            
            document.getElementById('modal-all-orders').innerHTML = allOrdersHtml;
        }

        function calculateCurrentTotal() {
            let total = 0;
            
            // Menu
            total += parseInt(document.getElementById('menu-completo').textContent) * 20;
            total += parseInt(document.getElementById('menu-pizza').textContent) * 15;
            total += parseInt(document.getElementById('menu-bambino').textContent) * 12;
            
            // Bevande (esclusa l'acqua che è gratuita)
            total += parseInt(document.getElementById('birra-mezzo').textContent) * 3;
            total += parseInt(document.getElementById('birra-litro').textContent) * 6;
            total += parseInt(document.getElementById('coca-lattina').textContent) * 2.5;
            total += parseInt(document.getElementById('coca-mezzo').textContent) * 3;
            total += parseInt(document.getElementById('coca-litro').textContent) * 6;
            total += parseInt(document.getElementById('vino-mezzo').textContent) * 4;
            total += parseInt(document.getElementById('vino-litro').textContent) * 8;
            
            return total;
        }

        function calculateOrderTotal(order) {
            let total = 0;
            total += order.menus.completo * 20;
            total += order.menus.pizza * 15;
            total += order.menus.bambino * 12;
            
            for (const [key, value] of Object.entries(order.drinks)) {
                switch(key) {
                    case 'birraMezzo': total += value * 3; break;
                    case 'birraLitro': total += value * 6; break;
                    case 'cocaLattina': total += value * 2.5; break;
                    case 'cocaMezzo': total += value * 3; break;
                    case 'cocaLitro': total += value * 6; break;
                    case 'vinoMezzo': total += value * 4; break;
                    case 'vinoLitro': total += value * 8; break;
                    // L'acqua (key 'acquaNaturale' e 'acquaFrizzante') non viene aggiunta al totale
                }
            }
            
            return total;
        }

        function showFullSummary() {
            if (allOrders.length === 0) {
                showCustomAlert(
                    "Attenzione", 
                    "Nessun ordine registrato",
                    function() {
                        // Nessuna azione dopo la chiusura
                    }
                );
                return;
            }
            
            let summary = "<h2>Recap Completo Ordini</h2>";
            let grandTotal = 0;
            
            // Raggruppa per tavolo
            const tables = {};
            allOrders.forEach(order => {
                if (!tables[order.table]) {
                    tables[order.table] = {
                        orders: [],
                        total: 0
                    };
                }
                
                let orderTotal = calculateOrderTotal(order);
                
                tables[order.table].orders.push(order);
                tables[order.table].total += orderTotal;
                grandTotal += orderTotal;
            });
            
            // Crea il riepilogo per ogni tavolo
            for (const [table, data] of Object.entries(tables)) {
                summary += `<h3>Tavolo ${table} - Totale: €${data.total.toFixed(2)}</h3>`;
                
                data.orders.forEach(order => {
                    summary += `<p><strong>${order.timestamp}</strong> - ${order.people} persone - €${calculateOrderTotal(order).toFixed(2)}</p>`;
                });
            }
            
            summary += `<h3 style="margin-top: 15px;">Totale Generale: €${grandTotal.toFixed(2)}</h3>`;
            
            // Crea una nuova finestra per il riepilogo
            const summaryWindow = window.open('', '_blank', 'width=800,height=600');
            summaryWindow.document.write(`
                <html>
                <head>
                    <title>Recap Completo Ordini</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 15px; }
                        h2 { color: #2c3e50; }
                        h3 { color: #e74c3c; margin-top: 15px; }
                        p { margin: 5px 0; }
                        .free-item { color: #27ae60; font-weight: bold; }
                    </style>
                </head>
                <body>
                    ${summary}
                    <button onclick="window.print()" style="padding: 8px 12px; background: #2c3e50; color: white; border: none; cursor: pointer; margin-top: 15px;">Stampa</button>
                </body>
                </html>
            `);
        }

        function deleteOrder(index) {
            showCustomAlert(
                "Elimina Ordine", 
                "Sei sicuro di voler eliminare definitivamente questo ordine?",
                function() {
                    // Azione di conferma
                    allOrders.splice(index, 1);
                    localStorage.setItem('pizzeria-orders', JSON.stringify(allOrders));
                    renderOrdersManagement();
                    
                    // Mostra un messaggio di successo
                    showCustomAlert(
                        "Ordine Eliminato", 
                        "L'ordine è stato eliminato con successo!",
                        function() {
                            // Nessuna azione dopo la chiusura
                        }
                    );
                }
            );
        }

        // Modal per il riepilogo
        function showSummaryModal(tab = 'current') {
            if (tab === 'current') {
                updateSummary();
            } else {
                updateAllOrdersSummary();
            }
            
            // Imposta la tab attiva
            switchTab(tab);
            
            // Mostra il modal
            document.getElementById('summary-modal').style.display = 'flex';
        }

        function hideSummaryModal() {
            document.getElementById('summary-modal').style.display = 'none';
        }

        function switchTab(tab) {
            // Nascondi tutti i contenuti
            document.querySelectorAll('.modal-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Rimuovi la classe active da tutte le tab
            document.querySelectorAll('.modal-tab').forEach(tabEl => {
                tabEl.classList.remove('active');
            });
            
            // Mostra il contenuto corretto e attiva la tab
            if (tab === 'current') {
                document.getElementById('current-summary').classList.add('active');
                document.getElementById('current-tab').classList.add('active');
            } else {
                document.getElementById('all-summary').classList.add('active');
                document.getElementById('all-tab').classList.add('active');
            }
        }

        // Funzione per mostrare alert personalizzati
        function showCustomAlert(title, message, confirmCallback, cancelCallback) {
            const alertEl = document.getElementById('customAlert');
            const overlayEl = document.getElementById('customAlertOverlay');
            const titleEl = document.getElementById('customAlertTitle');
            const messageEl = document.getElementById('customAlertMessage');
            const confirmBtn = document.getElementById('customAlertConfirm');
            const cancelBtn = document.getElementById('customAlertCancel');
            
            // Imposta titolo e messaggio
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Mostra l'alert
            alertEl.style.display = 'block';
            overlayEl.style.display = 'block';
            
            // Nascondi il pulsante annulla se non c'è callback
            if (!cancelCallback) {
                cancelBtn.style.display = 'none';
            } else {
                cancelBtn.style.display = 'block';
            }
            
            // Funzione per nascondere l'alert
            const hideAlert = () => {
                alertEl.style.display = 'none';
                overlayEl.style.display = 'none';
            };
            
            // Gestione click su conferma
            confirmBtn.onclick = () => {
                hideAlert();
                if (typeof confirmCallback === 'function') {
                    confirmCallback();
                }
            };
            
            // Gestione click su annulla
            cancelBtn.onclick = () => {
                hideAlert();
                if (typeof cancelCallback === 'function') {
                    cancelCallback();
                }
            };
            
            // Chiudi cliccando sull'overlay
            overlayEl.onclick = () => {
                hideAlert();
                if (typeof cancelCallback === 'function') {
                    cancelCallback();
                }
            };
        }

        // Funzione per stampare l'ordine corrente
        function printCurrentOrder() {
            const table = document.getElementById('table-number').value || "?";
            const pizzaNotes = document.getElementById('pizza-notes').value || "";
            const dessertNotes = document.getElementById('dessert-notes').value || "";
            
            // Calcola il totale
            const total = calculateCurrentTotal();
            
            // Prepara il template di stampa
            const printTemplate = document.getElementById('print-template').cloneNode(true);
            printTemplate.style.display = 'block';
            printTemplate.id = 'print-ready';
            
            // Popola i dati
            printTemplate.querySelector('#print-table').textContent = table;
            printTemplate.querySelector('#print-date').textContent = new Date().toLocaleString();
            printTemplate.querySelector('#print-operator').textContent = currentOperator;
            printTemplate.querySelector('#print-total-amount').textContent = total.toFixed(2);
            
            // Menu ordinati
            const menuItemsContainer = printTemplate.querySelector('#print-menu-items');
            menuItemsContainer.innerHTML = '<h4>Menu Ordinati:</h4>';
            
            const completo = parseInt(document.getElementById('menu-completo').textContent);
            const pizza = parseInt(document.getElementById('menu-pizza').textContent);
            const bambino = parseInt(document.getElementById('menu-bambino').textContent);
            
            if (completo > 0) {
                menuItemsContainer.innerHTML += `<div class="print-order-item">Menu Completo: ${completo} x €20 = €${(completo * 20).toFixed(2)}</div>`;
            }
            if (pizza > 0) {
                menuItemsContainer.innerHTML += `<div class="print-order-item">Menu Solo Pizza: ${pizza} x €15 = €${(pizza * 15).toFixed(2)}</div>`;
            }
            if (bambino > 0) {
                menuItemsContainer.innerHTML += `<div class="print-order-item">Menu Bambino: ${bambino} x €12 = €${(bambino * 12).toFixed(2)}</div>`;
            }
            
            // Bevande
            const drinkItemsContainer = printTemplate.querySelector('#print-drink-items');
            drinkItemsContainer.innerHTML = '<h4>Bevande:</h4>';
            
            const acquaNaturale = parseInt(document.getElementById('acqua-naturale').textContent);
            const acquaFrizzante = parseInt(document.getElementById('acqua-frizzante').textContent);
            const birraMezzo = parseInt(document.getElementById('birra-mezzo').textContent);
            const birraLitro = parseInt(document.getElementById('birra-litro').textContent);
            const cocaLattina = parseInt(document.getElementById('coca-lattina').textContent);
            const cocaMezzo = parseInt(document.getElementById('coca-mezzo').textContent);
            const cocaLitro = parseInt(document.getElementById('coca-litro').textContent);
            const vinoMezzo = parseInt(document.getElementById('vino-mezzo').textContent);
            const vinoLitro = parseInt(document.getElementById('vino-litro').textContent);
            
            if (acquaNaturale > 0 || acquaFrizzante > 0) {
                let acque = [];
                if (acquaNaturale > 0) acque.push(`${acquaNaturale} Naturale`);
                if (acquaFrizzante > 0) acque.push(`${acquaFrizzante} Frizzante`);
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Acqua: ${acque.join(', ')} <span class="free-item">(gratuita)</span></div>`;
            }
            
            if (birraMezzo > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Birra alla Spina (0.5L): ${birraMezzo} x €3 = €${(birraMezzo * 3).toFixed(2)}</div>`;
            }
            if (birraLitro > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Birra alla Spina (1L): ${birraLitro} x €6 = €${(birraLitro * 6).toFixed(2)}</div>`;
            }
            if (cocaLattina > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Coca Cola Lattina: ${cocaLattina} x €2.5 = €${(cocaLattina * 2.5).toFixed(2)}</div>`;
            }
            if (cocaMezzo > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Coca Cola Spina (0.5L): ${cocaMezzo} x €3 = €${(cocaMezzo * 3).toFixed(2)}</div>`;
            }
            if (cocaLitro > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Coca Cola Spina (1L): ${cocaLitro} x €6 = €${(cocaLitro * 6).toFixed(2)}</div>`;
            }
            if (vinoMezzo > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Vino alla Spina (0.5L): ${vinoMezzo} x €4 = €${(vinoMezzo * 4).toFixed(2)}</div>`;
            }
            if (vinoLitro > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Vino alla Spina (1L): ${vinoLitro} x €8 = €${(vinoLitro * 8).toFixed(2)}</div>`;
            }
            
            // Note pizze e dolci
            if (pizzaNotes || dessertNotes) {
                printTemplate.querySelector('#print-notes-container').style.display = 'block';
                let notesHtml = '';
                
                if (pizzaNotes) {
                    notesHtml += `<p><strong>Pizze:</strong><br>${pizzaNotes.replace(/\n/g, '<br>')}</p>`;
                }
                
                if (dessertNotes) {
                    notesHtml += `<p><strong>Dolci:</strong><br>${dessertNotes.replace(/\n/g, '<br>')}</p>`;
                }
                
                printTemplate.querySelector('#print-notes').innerHTML = notesHtml;
            }
            
            // Aggiungi il template al documento
            document.body.appendChild(printTemplate);
            
            // Stampa
            window.print();
            
            // Rimuovi il template dopo la stampa
            setTimeout(() => {
                document.body.removeChild(printTemplate);
            }, 1000);
        }

        // Funzione per stampare un ordine esistente
        function printOrder(index) {
            const order = allOrders[index];
            
            // Prepara il template di stampa
            const printTemplate = document.getElementById('print-template').cloneNode(true);
            printTemplate.style.display = 'block';
            printTemplate.id = 'print-ready';
            
            // Popola i dati
            printTemplate.querySelector('#print-table').textContent = order.table;
            printTemplate.querySelector('#print-date').textContent = order.timestamp;
            printTemplate.querySelector('#print-operator').textContent = order.operator;
            printTemplate.querySelector('#print-total-amount').textContent = calculateOrderTotal(order).toFixed(2);
            
            // Menu ordinati
            const menuItemsContainer = printTemplate.querySelector('#print-menu-items');
            menuItemsContainer.innerHTML = '<h4>Menu Ordinati:</h4>';
            
            if (order.menus.completo > 0) {
                menuItemsContainer.innerHTML += `<div class="print-order-item">Menu Completo: ${order.menus.completo} x €20 = €${(order.menus.completo * 20).toFixed(2)}</div>`;
            }
            if (order.menus.pizza > 0) {
                menuItemsContainer.innerHTML += `<div class="print-order-item">Menu Solo Pizza: ${order.menus.pizza} x €15 = €${(order.menus.pizza * 15).toFixed(2)}</div>`;
            }
            if (order.menus.bambino > 0) {
                menuItemsContainer.innerHTML += `<div class="print-order-item">Menu Bambino: ${order.menus.bambino} x €12 = €${(order.menus.bambino * 12).toFixed(2)}</div>`;
            }
            
            // Bevande
            const drinkItemsContainer = printTemplate.querySelector('#print-drink-items');
            drinkItemsContainer.innerHTML = '<h4>Bevande:</h4>';
            
            if (order.drinks.acquaNaturale > 0 || order.drinks.acquaFrizzante > 0) {
                let acque = [];
                if (order.drinks.acquaNaturale > 0) acque.push(`${order.drinks.acquaNaturale} Naturale`);
                if (order.drinks.acquaFrizzante > 0) acque.push(`${order.drinks.acquaFrizzante} Frizzante`);
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Acqua: ${acque.join(', ')} <span class="free-item">(gratuita)</span></div>`;
            }
            
            if (order.drinks.birraMezzo > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Birra alla Spina (0.5L): ${order.drinks.birraMezzo} x €3 = €${(order.drinks.birraMezzo * 3).toFixed(2)}</div>`;
            }
            if (order.drinks.birraLitro > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Birra alla Spina (1L): ${order.drinks.birraLitro} x €6 = €${(order.drinks.birraLitro * 6).toFixed(2)}</div>`;
            }
            if (order.drinks.cocaLattina > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Coca Cola Lattina: ${order.drinks.cocaLattina} x €2.5 = €${(order.drinks.cocaLattina * 2.5).toFixed(2)}</div>`;
            }
            if (order.drinks.cocaMezzo > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Coca Cola Spina (0.5L): ${order.drinks.cocaMezzo} x €3 = €${(order.drinks.cocaMezzo * 3).toFixed(2)}</div>`;
            }
            if (order.drinks.cocaLitro > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Coca Cola Spina (1L): ${order.drinks.cocaLitro} x €6 = €${(order.drinks.cocaLitro * 6).toFixed(2)}</div>`;
            }
            if (order.drinks.vinoMezzo > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Vino alla Spina (0.5L): ${order.drinks.vinoMezzo} x €4 = €${(order.drinks.vinoMezzo * 4).toFixed(2)}</div>`;
            }
            if (order.drinks.vinoLitro > 0) {
                drinkItemsContainer.innerHTML += `<div class="print-order-item">Vino alla Spina (1L): ${order.drinks.vinoLitro} x €8 = €${(order.drinks.vinoLitro * 8).toFixed(2)}</div>`;
            }
            
            // Note pizze e dolci
            if (order.pizzaNotes || order.dessertNotes) {
                printTemplate.querySelector('#print-notes-container').style.display = 'block';
                let notesHtml = '';
                
                if (order.pizzaNotes) {
                    notesHtml += `<p><strong>Pizze:</strong><br>${order.pizzaNotes.replace(/\n/g, '<br>')}</p>`;
                }
                
                if (order.dessertNotes) {
                    notesHtml += `<p><strong>Dolci:</strong><br>${order.dessertNotes.replace(/\n/g, '<br>')}</p>`;
                }
                
                printTemplate.querySelector('#print-notes').innerHTML = notesHtml;
            }
            
            // Aggiungi il template al documento
            document.body.appendChild(printTemplate);
            
            // Stampa
            window.print();
            
            // Rimuovi il template dopo la stampa
            setTimeout(() => {
                document.body.removeChild(printTemplate);
            }, 1000);
        }
    </script>
</body>
</html>
